plugins {
    id 'java-gradle-plugin'
}

repositories {
    mavenCentral()
}

dependencies {
    compileOnly("org.projectlombok:lombok:1.18.42")
	annotationProcessor("org.projectlombok:lombok:1.18.42")

    testImplementation 'org.junit.jupiter:junit-jupiter-engine:5.13.0-M3'
    testRuntimeOnly 'org.junit.jupiter:junit-jupiter-engine:5.13.0-M3'
}

gradlePlugin {
    plugins {
        greeting {
            id = 'shell-package'
            implementationClass = 'net.tetrakoopa.gradle.plugin.shell.ShellPackagePlugin'
        }
    }
}

jar {
    duplicatesStrategy = DuplicatesStrategy.FAIL
    archiveBaseName = "shell-package-plugin"
}

sourceSets {
    main {
        resources {
            srcDirs "tool"
        }
    }
}

test {
    // Enable JUnit 5 (Gradle 4.6+).
    // FIXME Does not work ::::
    useJUnitPlatform()
}

def functionalTest = sourceSets.create('functionalTest')
gradlePlugin.testSourceSets(functionalTest)

configurations[functionalTest.implementationConfigurationName].extendsFrom(configurations.testImplementation)

def functionalTestTask = tasks.register('functionalTest', Test) {
    testClassesDirs = functionalTest.output.classesDirs
    classpath = configurations[functionalTest.runtimeClasspathConfigurationName] + functionalTest.output
}

tasks.check.configure {
    dependsOn(functionalTestTask)
}
